    /**
     *  The maximum length of cell contents (text) is 32,767 characters.
     */
    public void testMaxTextLength(){
        HSSFSheet sheet = new HSSFWorkbook().createSheet();
        HSSFCell cell = sheet.createRow(0).createCell(0);

        int maxlen = SpreadsheetVersion.EXCEL97.getMaxTextLength();
        assertEquals(32767, maxlen);

        StringBuffer b = new StringBuffer() ;

        // 32767 is okay
        for( int i = 0 ; i < maxlen ; i++ )
        {
            b.append( "X" ) ;
        }
        cell.setCellValue(b.toString());

        b.append("X");
        // 32768 produces an invalid XLS file
        try {
            cell.setCellValue(b.toString());
            fail("Expected exception");
        } catch (IllegalArgumentException e){
            assertEquals("The maximum length of cell contents (text) is 32,767 characters", e.getMessage());
        }
    }

