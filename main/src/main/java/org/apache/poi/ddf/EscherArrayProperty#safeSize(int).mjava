    private static int safeSize(int complexSize) {
        // when called by user code, fix the size to be valid for the header
        return complexSize == 0 ? 6 : complexSize;
    }

